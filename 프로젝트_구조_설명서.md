# 프로젝트 구조 상세 설명서

## 📁 프로젝트 루트 디렉토리

### Streamlit 프론트엔드 파일들

#### `streamlit_app.py`
- **역할**: Streamlit 앱의 메인 진입점
- **기능**: 
  - Streamlit 페이지 설정 (제목, 아이콘, 레이아웃)
  - 세션 상태 초기화 (사용자 정보, 토큰)
  - 랜딩 페이지 UI 구성
- **실행**: `streamlit run streamlit_app.py`

#### `streamlit_requirements.txt`
- **역할**: Streamlit 프론트엔드 의존성 목록
- **포함 패키지**: streamlit, requests
- **설치**: `pip install -r streamlit_requirements.txt`

#### `streamlit_README.md`
- **역할**: Streamlit 프론트엔드 사용 가이드
- **내용**: 설치 방법, 실행 방법, 페이지 설명, API 연동 방법

---

### 📂 `pages/` 폴더
Streamlit의 멀티페이지 구조로, 각 파일이 하나의 페이지를 구성합니다.

#### `1_🏠_랜딩.py`
- **역할**: 메인 랜딩 페이지
- **기능**:
  - 서비스 소개
  - 회원가입/로그인 버튼
  - 주요 기능 소개 (표정, 음성, 내용, 리포트 분석)
- **이모지 순서**: 숫자와 이모지로 페이지 순서 결정

#### `2_📝_회원가입.py`
- **역할**: 신규 사용자 회원가입 페이지
- **기능**:
  - 이메일, 비밀번호, 이름 입력 폼
  - 회원가입 API 호출
  - 성공 시 온보딩 페이지로 이동
- **API**: `POST /api/v1/auth/signup`

#### `3_🔐_로그인.py`
- **역할**: 사용자 로그인 페이지
- **기능**:
  - 이메일, 비밀번호 입력 폼
  - 로그인 API 호출
  - 토큰을 세션 상태에 저장
  - 성공 시 온보딩 페이지로 이동
- **API**: `POST /api/v1/auth/login`
- **세션 상태**: `st.session_state.token`, `st.session_state.user`

#### `4_👤_온보딩.py`
- **역할**: 프로필 설정 페이지 (신규 가입자/로그인 후 첫 방문)
- **기능**:
  - 이름, 직무, 경력/학력 입력
  - 프로필 정보를 세션 상태에 저장
  - 나중에 하기 옵션 제공
- **세션 상태**: `st.session_state.profile`

#### `5_📖_서비스상세.py`
- **역할**: 서비스 기능 상세 설명 페이지
- **기능**:
  - 서비스 소개
  - 주요 기능 상세 설명 (표정/음성/내용 분석)
  - 분석 프로세스 소개
  - 추천 대상 안내
- **비로그인 접근 가능**: 누구나 볼 수 있는 정보 페이지

#### `6_📊_리포트.py`
- **역할**: 면접 결과 리포트 조회 페이지
- **기능**:
  - 세션 ID 입력으로 리포트 조회
  - 종합 평가 점수 표시
  - 종합 분석 리포트 (강점/약점)
  - 모듈별 점수 (표정, 음성, 내용)
  - 질문별 상세 분석 (있는 경우)
  - 액션 플랜 표시
- **API**: `GET /api/v1/interview/report/{session_id}`
- **로그인 필요**: `st.session_state.user` 체크

---

### 📂 `utils/` 폴더
공통 유틸리티 함수 및 클래스

#### `utils/__init__.py`
- **역할**: Python 패키지 초기화 파일
- **기능**: `utils` 폴더를 Python 패키지로 인식

#### `utils/api_client.py`
- **역할**: FastAPI 백엔드와의 통신 클라이언트
- **클래스**:
  - `AuthAPI`: 인증 관련 API (회원가입, 로그인, 사용자 정보 조회)
  - `ReportAPI`: 리포트 관련 API (리포트 조회)
  - `InterviewAPI`: 면접 관련 API (영상 업로드)
- **기능**:
  - `get_headers()`: 인증 토큰을 포함한 HTTP 헤더 생성
  - API 호출 및 에러 처리
- **API 베이스 URL**: `http://localhost:8000/api/v1`

---

### 📂 `.streamlit/` 폴더
Streamlit 설정 파일

#### `.streamlit/config.toml`
- **역할**: Streamlit 앱 전역 설정
- **설정 내용**:
  - 테마 색상 (primaryColor: #667eea)
  - 서버 포트 (8501)
  - headless 모드 (브라우저 자동 열기 제어)

---


---

## 🔧 백엔드 구조 (`app/` 폴더)

### 📂 `app/api/` - API 라우터
#### `app/api/deps.py`
- **역할**: FastAPI 의존성 주입
- **함수**:
  - `get_db_conn()`: 데이터베이스 연결 가져오기
  - `get_current_user()`: JWT 토큰으로 현재 사용자 인증

#### `app/api/v1/` - API 버전 1
##### `app/api/v1/auth.py`
- **역할**: 인증 관련 API 엔드포인트
- **엔드포인트**:
  - `POST /api/v1/auth/signup`: 회원가입
  - `POST /api/v1/auth/login`: 로그인
  - `GET /api/v1/auth/me`: 현재 사용자 정보 조회

##### `app/api/v1/interview.py`
- **역할**: 면접 관련 API 엔드포인트
- **엔드포인트**:
  - `POST /api/v1/interview/upload`: 면접 영상 업로드
  - `POST /api/v1/interview/{answer_id}/analyze`: 재분석 요청
  - `GET /api/v1/interview/report/{session_id}`: 리포트 조회 (구현 예정)

---

### 📂 `app/core/` - 핵심 설정 및 유틸리티
#### `app/core/config.py`
- **역할**: 애플리케이션 설정 관리
- **내용**: 데이터베이스 연결, JWT 시크릿 키, 토큰 만료 시간 등

#### `app/core/db.py`
- **역할**: 데이터베이스 연결 풀 관리
- **기능**: PostgreSQL 연결 풀 생성 및 관리

#### `app/core/security.py`
- **역할**: 보안 관련 함수
- **함수**:
  - `create_access_token()`: JWT 토큰 생성
  - `verify_password()`: 비밀번호 검증
  - `get_password_hash()`: 비밀번호 해싱

#### `app/core/exceptions.py`
- **역할**: 커스텀 예외 정의

#### `app/core/logging.py`
- **역할**: 로깅 설정

#### `app/core/transaction.py`
- **역할**: 데이터베이스 트랜잭션 관리

---

### 📂 `app/engines/` - AI 분석 엔진
#### `app/engines/visual/`
- **역할**: 표정 분석 엔진
- **파일**:
  - `engine.py`: MediaPipe를 사용한 얼굴 인식 및 표정 분석
  - `models/`: 학습된 모델 파일

#### `app/engines/voice/`
- **역할**: 음성 분석 엔진
- **파일**: `engine.py`: Librosa를 사용한 음성 분석

#### `app/engines/stt/`
- **역할**: Speech-to-Text 엔진
- **파일**: `engine.py`: Whisper를 사용한 음성을 텍스트로 변환

#### `app/engines/llm/`
- **역할**: LLM (Large Language Model) 엔진
- **파일**: `engine.py`: 답변 내용 분석 및 피드백 생성

#### `app/engines/common/`
- **역할**: 공통 결과 구조
- **파일**: `result.py`: 분석 결과 데이터 모델

---

### 📂 `app/repositories/` - 데이터 접근 계층
데이터베이스 CRUD 작업을 담당하는 레포지토리 패턴

#### `app/repositories/user_repo.py`
- **역할**: 사용자 데이터 접근
- **메서드**: 사용자 생성, 조회, 이메일로 검색

#### `app/repositories/answer_repo.py`
- **역할**: 답변 데이터 접근
- **메서드**: 답변 생성, 조회, 상태 업데이트

#### `app/repositories/visual_repo.py`
- **역할**: 표정 분석 결과 데이터 접근

#### `app/repositories/voice_repo.py`
- **역할**: 음성 분석 결과 데이터 접근

#### `app/repositories/content_repo.py`
- **역할**: 내용 분석 결과 데이터 접근

#### `app/repositories/final_report_repo.py`
- **역할**: 최종 리포트 데이터 접근
- **메서드**: 리포트 생성/업데이트, 조회

---

### 📂 `app/schemas/` - 데이터 스키마 (Pydantic 모델)
API 요청/응답 데이터 구조 정의

#### `app/schemas/user.py`
- **역할**: 사용자 관련 스키마
- **모델**: `UserCreate`, `UserLogin`, `UserResponse`

#### `app/schemas/interview.py`
- **역할**: 면접 관련 스키마
- **모델**: `AnswerResponse`

#### `app/schemas/report.py`
- **역할**: 리포트 관련 스키마
- **모델**: `FinalReportResult`, `ModuleScoreSummary`, `StrengthWeakness`, `ActionPlan`

#### `app/schemas/visual.py`
- **역할**: 표정 분석 결과 스키마
- **모델**: `VisualResult`, `VisualMetrics`

#### `app/schemas/voice.py`
- **역할**: 음성 분석 결과 스키마
- **모델**: `VoiceResult`, `VoiceMetrics`

#### `app/schemas/content.py`
- **역할**: 내용 분석 결과 스키마
- **모델**: `ContentResult`, `ContentMetrics`

#### `app/schemas/session.py`
- **역할**: 세션 관련 스키마
- **모델**: `SessionCreate`, `SessionResponse`, `QuestionResponse`

#### `app/schemas/common.py`
- **역할**: 공통 스키마
- **모델**: `AnalysisFeedback`, `TimeEvent`

---

### 📂 `app/services/` - 비즈니스 로직 계층
#### `app/services/auth_service.py`
- **역할**: 인증 비즈니스 로직
- **메서드**: `signup()`, `login()`

#### `app/services/analysis_service.py`
- **역할**: 면접 분석 오케스트레이션
- **기능**: 
  - 표정/음성/내용 분석 엔진 호출
  - 분석 결과 종합
  - 리포트 생성

---

### 📂 `app/models/` - 데이터 모델
#### `app/models/enums.py`
- **역할**: 열거형 정의
- **내용**: `SessionStatus`, `QuestionCategory` 등

---

### 📂 `app/utils/` - 유틸리티 함수
#### `app/utils/json_utils.py`
- **역할**: JSON 처리 유틸리티

#### `app/utils/media_utils.py`
- **역할**: 미디어 파일 처리 유틸리티

#### `app/utils/prompt_utils.py`
- **역할**: LLM 프롬프트 생성 유틸리티

---

## 📄 루트 파일들

### `main.py`
- **역할**: FastAPI 애플리케이션 메인 파일
- **기능**:
  - FastAPI 앱 인스턴스 생성
  - CORS 설정
  - API 라우터 등록
  - 루트 엔드포인트 (`/`)

### `readme.md`
- **역할**: 프로젝트 전체 README
- **내용**: 설치 가이드, 환경 설정 방법

### `environment.yml`
- **역할**: Conda 환경 설정 파일
- **내용**: 프로젝트에 필요한 모든 패키지 버전

### `프로젝트_점검_보고서.md`
- **역할**: 프로젝트 점검 결과 보고서
- **내용**: 구현 완료 사항, 누락 사항, 개선 제안

---

## 📁 데이터 저장 폴더

### `uploads/`
- **역할**: 업로드된 면접 영상 파일 저장
- **생성**: 자동 생성됨 (코드에서 `os.makedirs()`)

### `temp/`
- **역할**: 임시 파일 저장 (분석 중간 결과 등)

---

## 🔄 데이터 흐름

```
1. 사용자 → Streamlit 프론트엔드 (pages/*.py)
   ↓
2. API 호출 → utils/api_client.py
   ↓
3. HTTP 요청 → FastAPI 백엔드 (app/api/v1/*.py)
   ↓
4. 비즈니스 로직 → app/services/*.py
   ↓
5. 데이터 접근 → app/repositories/*.py
   ↓
6. AI 분석 → app/engines/*/engine.py
   ↓
7. 데이터베이스 → PostgreSQL
```

---

## 🚀 실행 순서

1. **백엔드 서버 실행**
   ```bash
   uvicorn app.main:app --reload --port 8000
   ```

2. **Streamlit 프론트엔드 실행**
   ```bash
   streamlit run streamlit_app.py
   ```

3. **브라우저 접속**
   - Streamlit: `http://localhost:8501`
   - FastAPI 문서: `http://localhost:8000/docs`

---

## 📝 참고사항

- **세션 상태**: Streamlit은 페이지 새로고침 시 세션 상태가 유지되지만, 서버 재시작 시 초기화됩니다.
- **API 통신**: `utils/api_client.py`에서 `localhost:8000`을 하드코딩했으므로, 배포 시 환경 변수로 변경 필요
- **포트 충돌**: 8501 포트가 사용 중이면 다른 포트 지정 가능: `streamlit run streamlit_app.py --server.port 8502`
